<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFT PRO BOT - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0a0a0a',
                            card: '#1a1a1a',
                            border: '#2a2a2a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-glow {
            animation: pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }
    </style>
</head>
<body class="bg-dark-bg text-gray-100 font-mono">
    <div class="container mx-auto p-4 max-w-[1600px]">
        <!-- Header -->
        <div id="header" class="bg-dark-card border-2 border-cyan-500 rounded-lg p-4 mb-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <h1 class="text-2xl font-bold text-cyan-400" id="headerTitle">‚ö° HFT PRO BOT</h1>
                    <span class="px-3 py-1 rounded-full text-sm font-semibold" id="envBadge">TESTNET</span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-green-500 pulse-glow"></div>
                        <span class="text-green-400 text-sm">WebSocket Connected</span>
                    </div>
                    <div id="stopLossBadge" class="px-3 py-1 rounded-full text-sm font-semibold">
                        üõ°Ô∏è Stop Loss: ON
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-4 mb-4">
            <!-- Balance Card -->
            <div class="bg-dark-card border border-green-500 rounded-lg p-4">
                <div class="text-sm text-gray-400 mb-2">üí∞ Balance</div>
                <div class="text-3xl font-bold text-green-400" id="balance">0.00</div>
                <div class="flex gap-4 mt-2 text-sm">
                    <div>
                        <span class="text-gray-400">Inicial:</span>
                        <span id="initialBalance" class="text-white ml-1">0.00</span>
                    </div>
                    <div>
                        <span class="text-gray-400">Sesi√≥n:</span>
                        <span id="sessionProfit" class="ml-1">+0.00</span>
                        <span id="sessionProfitPct" class="ml-1">(+0.00%)</span>
                    </div>
                </div>
            </div>

            <!-- Positions Card -->
            <div class="bg-dark-card border border-yellow-500 rounded-lg p-4">
                <div class="text-sm text-gray-400 mb-2">üíº Posiciones</div>
                <div class="text-3xl font-bold text-yellow-400">
                    <span id="activePositions">0</span>/<span id="maxPositions">0</span>
                </div>
                <div class="flex gap-4 mt-2 text-sm">
                    <div>
                        <span class="text-gray-400">Pares:</span>
                        <span id="activePairs" class="text-cyan-400 ml-1">0</span>
                    </div>
                    <div>
                        <span class="text-gray-400">üî• Vol√°tiles:</span>
                        <span id="volatilePairs" class="text-green-400 ml-1">0</span>
                    </div>
                </div>
            </div>

            <!-- Trades Card -->
            <div class="bg-dark-card border border-blue-500 rounded-lg p-4">
                <div class="text-sm text-gray-400 mb-2">üìà Trades</div>
                <div class="text-3xl font-bold text-blue-400" id="totalTrades">0</div>
                <div class="flex gap-4 mt-2 text-sm">
                    <div>
                        <span class="text-green-400">‚úÖ</span>
                        <span id="winningTrades" class="text-green-400 ml-1">0</span>
                    </div>
                    <div>
                        <span class="text-red-400">‚ùå</span>
                        <span id="losingTrades" class="text-red-400 ml-1">0</span>
                    </div>
                    <div>
                        <span class="text-gray-400">Win Rate:</span>
                        <span id="winRate" class="text-cyan-400 ml-1">0%</span>
                    </div>
                </div>
            </div>

            <!-- P/L Card -->
            <div class="bg-dark-card border border-purple-500 rounded-lg p-4">
                <div class="text-sm text-gray-400 mb-2">üìä P/L Real</div>
                <div class="text-3xl font-bold" id="netProfit">+0.0000</div>
                <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
                    <div>
                        <span class="text-gray-400">Ganancias:</span>
                        <div id="totalGains" class="text-green-400">+0.0000</div>
                    </div>
                    <div>
                        <span class="text-gray-400">P√©rdidas:</span>
                        <div id="totalLosses" class="text-red-400">-0.0000</div>
                    </div>
                    <div>
                        <span class="text-gray-400">Comisiones:</span>
                        <div id="totalCommissions" class="text-yellow-400">0.0000</div>
                    </div>
                    <div>
                        <span class="text-gray-400">Latencia:</span>
                        <div id="avgLatency" class="text-yellow-400">0ms</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Stats -->
        <div class="bg-dark-card border border-magenta-500 rounded-lg p-4 mb-4">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-sm">
                <div>
                    <span class="text-gray-400">Workers:</span>
                    <span id="workers" class="text-magenta-400 ml-2">0/0</span>
                </div>
                <div>
                    <span class="text-gray-400">Directos:</span>
                    <span id="directAnalysis" class="text-yellow-400 ml-2">0/50</span>
                </div>
                <div>
                    <span class="text-gray-400">Cola:</span>
                    <span id="queue" class="text-cyan-400 ml-2">0/0</span>
                </div>
                <div>
                    <span class="text-gray-400">Jobs:</span>
                    <span id="jobsProcessed" class="text-cyan-400 ml-2">0</span>
                </div>
                <div>
                    <span class="text-gray-400">‚è±Ô∏è Uptime:</span>
                    <span id="uptime" class="text-white ml-2">0s</span>
                </div>
            </div>
        </div>

        <!-- Configuration and Controls Panel -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
            <!-- Bot Status and Control -->
            <div class="bg-dark-card border-2 rounded-lg p-4" id="botStatusCard">
                <h3 class="text-lg font-bold mb-3" id="botStatusTitle">ü§ñ Control del Bot</h3>
                <div class="space-y-3">
                    <div class="flex items-center gap-3">
                        <div id="botStatusIndicator" class="w-4 h-4 rounded-full"></div>
                        <span id="botStatusText" class="font-semibold"></span>
                    </div>
                    <div class="flex gap-2">
                        <button id="startBtn" onclick="startBot()" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            ‚ñ∂Ô∏è Iniciar
                        </button>
                        <button id="stopBtn" onclick="stopBot()" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            ‚è∏Ô∏è Detener
                        </button>
                    </div>
                    <div class="mt-2">
                        <button onclick="reconnectBinance()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm">
                            üîÑ Reconectar a Binance
                        </button>
                    </div>
                </div>
            </div>

            <!-- Configuration Form -->
            <div class="lg:col-span-2 bg-dark-card border border-cyan-500 rounded-lg p-4">
                <h3 class="text-lg font-bold text-cyan-400 mb-3">‚öôÔ∏è Configuraci√≥n</h3>

                <!-- API Configuration -->
                <div class="mb-3 pb-3 border-b border-gray-700">
                    <div class="text-xs text-gray-500 mb-2 font-semibold">üîë CREDENCIALES DE API</div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div class="md:col-span-2">
                            <label class="text-xs text-gray-400 block mb-1">API Key</label>
                            <input type="text" id="userAPIKey" placeholder="Ingresa tu API Key de Binance" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                        <div class="flex items-end">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="useTestnet" class="w-4 h-4 rounded bg-dark-bg border-gray-600 text-cyan-500 focus:ring-cyan-500">
                                <span class="text-sm text-white">üß™ Testnet</span>
                            </label>
                        </div>
                    </div>
                    <div class="mt-2">
                        <label class="text-xs text-gray-400 block mb-1">Secret Key</label>
                        <input type="password" id="userSecretKey" placeholder="Ingresa tu Secret Key de Binance" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                    </div>
                    <div class="mt-2 text-xs text-yellow-400">
                        ‚ö†Ô∏è Tus credenciales se almacenan solo en memoria y no se guardan en disco.
                    </div>
                </div>

                <!-- Capital Management -->
                <div class="mb-3">
                    <div class="text-xs text-gray-500 mb-2 font-semibold">üí∞ GESTI√ìN DE CAPITAL</div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Inversi√≥n Total (USDT)</label>
                            <input type="number" id="totalInvestUSDT" step="10" min="10" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Por Posici√≥n (USDT)</label>
                            <input type="number" id="investPerPosition" step="1" min="10" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Max Posiciones</label>
                            <input type="number" id="maxPositionsInput" step="1" min="1" max="50" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                        <div class="flex items-end">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="useStopLoss" class="w-4 h-4 rounded bg-dark-bg border-gray-600 text-cyan-500 focus:ring-cyan-500">
                                <span class="text-sm text-white">üõ°Ô∏è Stop Loss</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Targets & Stop Loss -->
                <div class="mb-3">
                    <div class="text-xs text-gray-500 mb-2 font-semibold">üìä TARGETS Y STOP LOSS (%)</div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Target R√°pido (%)</label>
                            <input type="number" id="quickProfitTarget" step="0.1" min="0.1" max="5" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Target Normal (%)</label>
                            <input type="number" id="normalProfitTarget" step="0.1" min="0.1" max="10" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Stop Loss (%)</label>
                            <input type="number" id="stopLossPercent" step="0.1" min="0.1" max="5" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Trailing Stop (%)</label>
                            <input type="number" id="trailingStop" step="0.1" min="0.1" max="5" class="w-full bg-dark-bg border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Advanced Configuration (Collapsible) -->
                <div class="mb-3 border-t border-gray-700 pt-3">
                    <button onclick="toggleAdvancedConfig()" class="flex items-center gap-2 text-sm text-yellow-400 hover:text-yellow-300 transition-colors mb-2">
                        <span id="advancedToggleIcon">‚ñ∂</span>
                        <span class="font-semibold">‚ö†Ô∏è CONFIGURACI√ìN AVANZADA (Solo usuarios experimentados)</span>
                    </button>

                    <div id="advancedConfigPanel" class="hidden">
                        <div class="bg-yellow-900/20 border border-yellow-600 rounded-lg p-3 mb-3">
                            <div class="text-xs text-yellow-300 mb-1 font-semibold">‚ö†Ô∏è ADVERTENCIA:</div>
                            <div class="text-xs text-yellow-200">
                                Estos par√°metros afectan el comportamiento HFT del bot. Modificarlos incorrectamente puede resultar en p√©rdidas garantizadas.
                                Los valores por defecto est√°n matem√°ticamente optimizados para cubrir comisiones.
                            </div>
                        </div>

                        <div class="text-xs text-gray-500 mb-2 font-semibold">‚ö° TARGETS HFT AVANZADOS (%)</div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <div>
                                <label class="text-xs text-gray-400 block mb-1">
                                    Micro Scalp Target (%)
                                    <span class="text-gray-600">- Default: 0.30%</span>
                                </label>
                                <input type="number" id="microScalpTarget" step="0.05" min="0.1" max="2" class="w-full bg-dark-bg border border-yellow-600 rounded px-2 py-1 text-sm text-white focus:border-yellow-500 focus:outline-none">
                                <div class="text-xs text-gray-500 mt-1">Profit neto: ~0.10% despu√©s de comisiones</div>
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 block mb-1">
                                    Max Profit Target (%)
                                    <span class="text-gray-600">- Default: 1.30%</span>
                                </label>
                                <input type="number" id="maxProfitTarget" step="0.1" min="0.5" max="5" class="w-full bg-dark-bg border border-yellow-600 rounded px-2 py-1 text-sm text-white focus:border-yellow-500 focus:outline-none">
                                <div class="text-xs text-gray-500 mt-1">Profit neto: ~1.10% despu√©s de comisiones</div>
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 block mb-1">
                                    Micro Stop Loss (%)
                                    <span class="text-gray-600">- Default: 0.10%</span>
                                </label>
                                <input type="number" id="microStopLoss" step="0.05" min="0.05" max="1" class="w-full bg-dark-bg border border-yellow-600 rounded px-2 py-1 text-sm text-white focus:border-yellow-500 focus:outline-none">
                                <div class="text-xs text-gray-500 mt-1">P√©rdida real: ~0.30% con comisiones</div>
                            </div>
                        </div>

                        <button onclick="resetAdvancedToDefaults()" class="mt-3 bg-gray-600 hover:bg-gray-700 text-white px-4 py-1 rounded text-xs transition-colors">
                            üîÑ Restaurar valores por defecto
                        </button>
                    </div>
                </div>

                <button onclick="saveConfig()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors text-sm">
                    üíæ Guardar Configuraci√≥n
                </button>
            </div>
        </div>

        <!-- Trade Controls -->
        <div class="flex gap-4 mb-4">
            <button onclick="closeAllTrades()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                üîí Cerrar Todas las Posiciones
            </button>
            <button onclick="closeProfitTrades()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                üí∞ Cerrar Solo con Ganancia
            </button>
            <button onclick="resetBot()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                üîÑ Reset Completo
            </button>
        </div>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
            <!-- Left Column -->
            <div class="space-y-4">
                <!-- Positions Table -->
                <div class="bg-dark-card border border-yellow-500 rounded-lg p-4">
                    <h2 class="text-xl font-bold text-yellow-400 mb-4">üíº Posiciones Activas</h2>
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full text-sm">
                            <thead class="border-b border-gray-700">
                                <tr class="text-left">
                                    <th class="pb-2">S√≠mbolo</th>
                                    <th class="pb-2">Compra</th>
                                    <th class="pb-2">Actual</th>
                                    <th class="pb-2">Target</th>
                                    <th class="pb-2">Stop</th>
                                    <th class="pb-2">P/L%</th>
                                    <th class="pb-2">Estrategia</th>
                                </tr>
                            </thead>
                            <tbody id="positionsTable" class="text-gray-300">
                                <tr>
                                    <td colspan="7" class="text-center py-4 text-gray-500">No hay posiciones activas</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Prices Table -->
                <div class="bg-dark-card border border-cyan-500 rounded-lg p-4">
                    <h2 class="text-xl font-bold text-cyan-400 mb-4">üíπ Precios en Tiempo Real</h2>
                    <div class="overflow-x-auto scrollbar-thin max-h-[500px]">
                        <table class="w-full text-sm">
                            <thead class="border-b border-gray-700 sticky top-0 bg-dark-card">
                                <tr class="text-left">
                                    <th class="pb-2">S√≠mbolo</th>
                                    <th class="pb-2">Precio</th>
                                    <th class="pb-2">Vol%</th>
                                    <th class="pb-2">RSI</th>
                                    <th class="pb-2">Se√±al</th>
                                    <th class="pb-2">Conf%</th>
                                </tr>
                            </thead>
                            <tbody id="pricesTable" class="text-gray-300">
                                <tr>
                                    <td colspan="6" class="text-center py-4 text-gray-500">Cargando precios...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Right Column - Logs -->
            <div class="bg-dark-card border border-magenta-500 rounded-lg p-4">
                <h2 class="text-xl font-bold text-magenta-400 mb-4">üìù Log de Actividad</h2>
                <div id="logBox" class="space-y-1 overflow-y-auto scrollbar-thin max-h-[800px] text-sm font-mono">
                    <div class="text-gray-500">Esperando logs...</div>
                </div>
            </div>
        </div>

        <!-- Close Summary Modal -->
        <div id="summaryModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
            <div class="bg-dark-card border-2 border-green-500 rounded-lg p-6 max-w-4xl max-h-[90vh] overflow-y-auto scrollbar-thin">
                <h2 class="text-2xl font-bold text-green-400 mb-4">üìã RESUMEN DE CIERRE</h2>
                <div id="summaryContent" class="space-y-4 text-sm"></div>
                <button onclick="closeSummaryModal()" class="mt-6 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
